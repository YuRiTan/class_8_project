{% extends "layout.html" %}
{% block title %}Home{% endblock %}
{% block current %}(current){% endblock %}
{% block content %}
  <h1 class="mt-5">Upload</h1>
  <p class="lead">Upload your file here</p>
  <form method="POST" enctype="multipart/form-data">
    <input type="file" name="whatsapp_data" id="whatsapp_data" />
    <input type="submit" value="Submit" />
  </form>
  {% if try_upload %}
<p> Please add a file before submitting.
  No statistics without data!</p>
  {% endif %}
  <h1 class="mt-3">Results</h1>
  {% if active_members %}
    <h2 class="mt-3">Basic stats</h2>
    <p>
      <h4>Active members: <b>{{ active_members }}</b></h4>
      <h4>Total messages: <b>{{ total_messages }}</b></h4>
    </p>
    <h2 class="mt-3">Users</h2>
    <p><div id="user_chart"></div></p>
    <h2 class="mt-3">Days</h2>
    <p><div id="days_chart"></div></p>
    <h2 class="mt-3">Repliers</h2>
    <p><div id="replier_chart"></div></p>
  {% else %}
    <p>After you upload a file, your results will be shown here.</p>
  {% endif %}
    <!-- generating plots -->
    <script>
        var chart_user = c3.generate({
            bindto: "#user_chart",
            data: {json: JSON.parse({{ users|tojson|safe }}), type: 'bar'},
            bar: {width: {ratio: 0.5}}
        });
        var chart_days = c3.generate({
              bindto: "#days_chart",
              data: {json: JSON.parse({{ days|tojson|safe }}), type: 'bar'},
              bar: {width: {ratio: 0.5}}
        });
        var chart_replier = c3.generate({
              bindto: "#replier_chart",
              data: {json: JSON.parse({{ repliers|tojson|safe }}), type: 'pie'}
        });
    </script>
{% endblock %}
